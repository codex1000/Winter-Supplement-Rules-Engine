# Winter Supplement Rules Engine

## Overview
This project implements a rules engine to determine eligibility and calculate the Winter Supplement based on client data. It uses an MQTT broker for event-driven communication.

---

## Table of Contents
- [Features](#features)
- [Prerequisites](#prerequisites)
- [Setup](#setup)
  - [Step 1: Clone the Repository](#step-1-clone-the-repository)
  - [Step 2: Set Up a Virtual Environment](#step-2-set-up-a-virtual-environment)
  - [Step 3: Install Dependencies](#step-3-install-dependencies)
  - [Step 4: Update MQTT Topic IDs](#step-4-update-mqtt-topic-ids)
  - [Step 5: Run the MQTT Client](#step-5-run-the-mqtt-client)
  - [Step 6: Test the Rules Engine](#step-6-test-the-rules-engine)
  - [Step 7: Run Unit Tests](#step-7-run-unit-tests)
- [Project Structure](#project-structure)
- [Troubleshooting](#troubleshooting)
- [License](#license)
- [Additional Resources](#additional-resources)

---

## Features
- **Eligibility Check**: Determines client eligibility for the Winter Supplement.
- **Supplement Calculation**: Calculates base and additional supplement amounts.
- **Event-Driven Communication**: Publishes results to a specified MQTT topic.

---

## Prerequisites
- Python 3.8+
- MQTT broker (e.g., [test.mosquitto.org](https://test.mosquitto.org))

---

## Setup

### Step 1: Clone the Repository
1. Open Terminal:
   - On macOS/Linux: Navigate to `Applications > Utilities > Terminal`.
   - On Windows: Use Command Prompt or PowerShell.
2. Clone the repository:
   ```bash
   git clone https://github.com/your-username/Winter-Supplement-Rules-Engine.git
   ```
3. Navigate to the project directory:
   ```bash
   cd Winter-Supplement-Rules-Engine
   ```

---

### Step 2: Set Up a Virtual Environment
1. Create a virtual environment:
   ```bash
   python3 -m venv .venv
   ```
2. Activate the virtual environment:
   - On macOS/Linux:
     ```bash
     source .venv/bin/activate
     ```
   - On Windows:
     ```bash
     .venv\Scripts\activate
     ```

---

### Step 3: Install Dependencies
Install required libraries:
```bash
pip install paho-mqtt
```

---

### Step 4: Update MQTT Topic IDs
1. Open `mqtt_client.py` in your preferred editor (e.g., VSCode or another IDE).
2. Update the topic IDs:
   Replace `<MQTT topic ID>` with your unique topic ID generated by the Winter Supplement web calculator.

   ```python
   INPUT_TOPIC = "BRE/calculateWinterSupplementInput/<MQTT topic ID>"
   OUTPUT_TOPIC = "BRE/calculateWinterSupplementOutput/<MQTT topic ID>"
   ```

---

### Step 5: Run the MQTT Client
Run the MQTT client:
```bash
python main.py
```
Verify the output in the terminal to ensure the client is connected to the MQTT broker and subscribed to the input topic.

---

### Step 6: Test the Rules Engine
1. **Use an MQTT Client Tool**:
   - Download and install an MQTT client tool like [MQTT.fx](https://mqttfx.jensd.de/) or [MQTT Explorer](http://mqtt-explorer.com/).
2. **Publish a Test Message**:
   - Connect to the MQTT broker (e.g., `test.mosquitto.org` on port 1883).
   - Publish a test message to the `INPUT_TOPIC`:
     ```json
     {
         "id": "123",
         "numberOfChildren": 2,
         "familyComposition": "couple",
         "familyUnitInPayForDecember": true
     }
     ```
3. **Verify the Response**:
   - Check the output in the terminal to confirm the rules engine processed the message and published results to the `OUTPUT_TOPIC`.

---

### Step 7: Run Unit Tests
Run the unit tests:
```bash
python -m unittest tests.py
```
Verify that all tests pass successfully.

---

## Project Structure
- **`rules_engine.py`**: Contains the logic for determining eligibility and calculating supplement amounts.
- **`mqtt_client.py`**: Manages MQTT communication, including subscriptions and message publication.
- **`tests.py`**: Contains unit tests for the rules engine.
- **`README.md`**: Project documentation.
- **`LICENSE`**: Details the project's licensing terms.

---

## Troubleshooting
- **Check MQTT Broker Connection**: Ensure your network permits outbound connections to `test.mosquitto.org` on port 1883.
- **Verify Topic IDs**: Confirm that the topic IDs in `mqtt_client.py` match those generated by the Winter Supplement web calculator.
- **Review Errors**: Look for error messages in the console output. Added print statements may help identify the issue.

---

## License
This project is licensed under the MIT License. See the [LICENSE](LICENSE) file for details.

---

## Additional Resources
- [Paho MQTT Python Client Documentation](https://www.eclipse.org/paho/index.php?page=clients/python/index.php)
- [MQTT.fx](https://mqttfx.jensd.de/)
- [MQTT Explorer](http://mqtt-explorer.com/)